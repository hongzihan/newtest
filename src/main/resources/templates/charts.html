<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
<title>Matrix Admin</title>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="stylesheet" href="../static/css/bootstrap.min.css" />
<link rel="stylesheet" href="../static/css/bootstrap-responsive.min.css" />
<link rel="stylesheet" href="../static/css/matrix-style.css" />
<link rel="stylesheet" href="../static/css/matrix-media.css" />
<link href="../static/font-awesome/css/font-awesome.css" rel="stylesheet" />
<link href='http://fonts.useso.com/css?family=Open+Sans:400,700,800' rel='stylesheet' type='text/css'>
</head>
<body>

<div th:replace="common/frame-main::frame-main"/>

<div id="content">
  <div id="content-header">
    <div id="breadcrumb"><a href="/index" title="首页" class="tip-bottom"><i class="icon-home"></i> 首页</a> <a href="/charts" class="current">数据统计</a></div>
    <h1>数据统计<span class="badge badge-success" th:if="${curZoneName}" th:text="${curZoneName}"/></h1>
  </div>
  <div class="container-fluid">
    <hr>
      <div class="span12">

        <div class="row-fluid">
            <div class="span12">
                <div class="dropdown">
                <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                  点我选区
                  <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                <!--              <li role="separator" class="divider"></li>-->
                  <li th:each="zoneName : ${zoneNameList}"><a th:href="'/charts?zoneid=' + ${zoneName}">[[${zoneName}]]</a></li>
                </ul>
                </div>
            </div>
        </div>

        <div class="row-fluid">
            <div class="span12">
                <div class="widget-box">
                    <div class="row">
                        <div class="col-md-3" id="main1" style="width: 450px;height:333px;"></div>
                        <div class="col-md-3" id="main2" style="width: 450px;height:333px;"></div>
                        <div class="col-md-3" id="main3" style="width: 450px;height:333px;"></div>
                        <div class="col-md-3" id="main4" style="width: 450px;height:333px;"></div>
                    </div>
                    <div class="row">
                        <div class="col-md-3" id="main5" style="width: 450px;height:333px;"></div>
                        <div class="col-md-3" id="main6" style="width: 450px;height:333px;"></div>
                        <div class="col-md-3" id="main7" style="width: 450px;height:333px;"></div>
                        <div class="col-md-3" id="main8" style="width: 450px;height:333px;"></div>
                    </div>
                </div>
            </div>
        </div>

      </div>
    </div>
  </div>
</div>

<!-- footer part begin -->
<div th:replace="common/frame-footer::frame-footer"/>
<!-- footer part end -->

<script src="../static/js/jquery.min.js"></script>
<script src="../static/js/bootstrap.min.js"></script>
<script src="../static/js/matrix.js"></script>
<script src="https://cdn.bootcss.com/echarts/4.2.1-rc1/echarts.min.js"></script>
<!--Real-time-chart-js-->
<script type="text/javascript">
    refurbishIndex = () => {
        $.ajax({
            type:"post",
            url:"/dropItem/showAll",
            data:{},
            async: false,
            success: data => {
                var optionJson= JSON.parse( data );
                optionJson.sort(function(a, b){return a.count - b.count});
                var dataAllLength = optionJson.length
                var mainCount = 8
                for (var chartCount = 0; chartCount < mainCount; chartCount++) {
                    var hengdata = []
                    var zongdata = []
                    var piedata = []
                    var preIndex = Math.floor(chartCount * (dataAllLength / mainCount))
                    var sufIndex = Math.floor((chartCount + 1) * (dataAllLength / mainCount))
                    var tempCount = 0
                    for (var i=preIndex; i<sufIndex; i++) {
                        [hengdata[i], zongdata[i]] = [optionJson[i].itemname, optionJson[i].count]
                        piedata[i] = {};
                        //let { foo: baz , bar: xxa} = { foo: 'aaa', bar: 'bbb' };
                        //{xa: piedata[i]["name"] , xb: piedata[i]["value"]} = {xa: optionJson[i].itemname, xb: optionJson[i].count}
                        piedata[i]["name"] = optionJson[i].itemname;
                        piedata[i]["value"] = optionJson[i].count;
                        tempCount = tempCount + 1;
                    }
                    if (piedata.length > 0) {
                        // 基于准备好的dom，初始化echarts实例
                        var myChart = echarts.init(document.getElementById('main' + (chartCount + 1)));

                        // 指定图表的配置项和数据
                        var option = {
                            title : {
                                text: '国际三国 物品掉落统计 ' + mainCount + ' - ' + (chartCount + 1),
                                x:'center'//水平居中
                            },
                            tooltip : {//提示框组件。
                                trigger: 'item',  //'item' 数据项图形触发，主要在散点图，饼图等无类目轴的图表中使用。
                                formatter: "{a} <br/>{b} : {c} ({d}%)" //{a}（系列名称），{b}（数据项名称），{c}（数值）, {d}（百分比）
                            },
                            series : [
                                {
                                    name: '物品概述',
                                    type: 'pie',
                                    radius : '55%',//饼图的半径
                                    center: ['50%', '60%'],//饼图的中心（圆心）坐标，数组的第一项是横坐标，第二项是纵坐标。
                                    data:piedata,
                                    itemStyle: {//图形样式。
                                        emphasis: {
                                            shadowBlur: 10,
                                            shadowOffsetX: 0,
                                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                                        }
                                    }
                                }
                            ]
                        };
                        // 使用刚指定的配置项和数据显示图表。
                        myChart.setOption(option);
                    }
                }
            }
        });
    }
    window.onload = () => {
        refurbishIndex()
    }
</script> 
<!--Real-time-chart-js-end-->
<!--Turning-series-chart-js-->
<script type="text/javascript">

</script> 
<!--Turning-series-chart-js-->
<script src="../static/js/matrix.dashboard.js"></script>
</body>
</html>
