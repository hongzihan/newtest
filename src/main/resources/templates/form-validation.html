<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
<title>Matrix Admin</title>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="stylesheet" href="../static/css/bootstrap.min.css" />
<link rel="stylesheet" href="../static/css/bootstrap-responsive.min.css" />
<link rel="stylesheet" href="../static/css/uniform.css" />
<link rel="stylesheet" href="../static/css/select2.css" />
<link rel="stylesheet" href="../static/css/matrix-style.css" />
<link rel="stylesheet" href="../static/css/matrix-media.css" />
<link href="../static/font-awesome/css/font-awesome.css" rel="stylesheet" />
</head>
<body>

<!--Header-part-->
<div th:replace="common/frame-main::frame-main"/>
<!--close-Header-part--> 

<!--top-Header-menu-->
<div id="content">
  <div id="content-header">
    <div id="breadcrumb"> <a href="index.html" title="Go to Home" class="tip-bottom"><i class="icon-home"></i> Home</a> <a href="#">Form elements</a> <a href="#" class="current">Validation</a> </div>
    <h1>权限管理</h1>
  </div>
  <div class="container-fluid"><hr>
    <!-- 用户操作 -->
    <div class="row-fluid">
      <div class="span12">
        <div class="widget-box">
          <div class="widget-title"> <span class="icon"> <i class="icon-info-sign"></i> </span>
            <h5>用户操作</h5>
          </div>
          <div class="widget-content nopadding">
            <form class="form-horizontal" method="post" action="#" id="user_action_form">
              <div class="control-group">
                <label class="control-label">用户名</label>
                <div class="controls">
                  <input type="text" name="username" id="user_action_username" th:value="${suser == null ? '' : suser.username}">
                </div>
              </div>
              <div class="control-group">
                <label class="control-label">密码</label>
                <div class="controls">
                  <input type="text" name="password" id="user_action_password" th:value="${suser == null ? '' : suser.password}">
                </div>
              </div>
              <div class="control-group">
                <label class="control-label">昵称</label>
                <div class="controls">
                  <input type="text" name="nickname" id="user_action_nickname" th:value="${suser == null ? '' : suser.nickname}">
                </div>
              </div>
              <div class="control-group">
                <label class="control-label">核心密码(救急)</label>
                <div class="controls">
                  <input type="number" name="corepwd" id="user_action_corepwd" th:value="${suser == null ? '' : suser.corepwd}">
                </div>
              </div>
              <div class="control-group">
                <label class="control-label">*操作类型 :</label>
                <div class="controls">
                  <label>
                    <input type="radio" name="type" value=1 checked/>
                    增加</label>
                  <label>
                    <input type="radio" name="type" value=2 />
                    删除</label>
                  <label>
                    <input type="radio" name="type" value=3 />
                    修改</label>
                </div>
              </div>
              <div class="form-actions">
                <input type="button" value="保存" class="btn btn-success"  onclick="isvalid('用户操作')">
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <!-- 角色操作 -->
    <div class="row-fluid">
      <div class="span12">
        <div class="widget-box">
          <div class="widget-title"> <span class="icon"> <i class="icon-info-sign"></i> </span>
            <h5>角色操作</h5>
          </div>
          <div class="widget-content nopadding">
            <form class="form-horizontal" method="post" action="#" id="role_action_form">
              <div class="control-group">
                <label class="control-label">角色名</label>
                <div class="controls">
                  <input type="text" name="rolename" id="role_action_username">
                </div>
              </div>
              <div class="control-group">
                <label class="control-label">角色描述</label>
                <div class="controls">
                  <input type="text" name="roledesc" id="role_action_password">
                </div>
              </div>
              <div class="control-group">
                <label class="control-label">*操作类型 :</label>
                <div class="controls">
                  <label>
                    <input type="radio" name="type" value=1 checked/>
                    增加</label>
                  <label>
                    <input type="radio" name="type" value=2 />
                    删除</label>
                  <label>
                    <input type="radio" name="type" value=3 />
                    修改</label>
                </div>
              </div>
              <div class="form-actions">
                <input type="button" value="保存" class="btn btn-success"  onclick="isvalid('角色操作')">
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <!-- 权限操作 -->
    <div class="row-fluid">
      <div class="span12">
        <div class="widget-box">
          <div class="widget-title"> <span class="icon"> <i class="icon-info-sign"></i> </span>
            <h5>权限操作</h5>
          </div>
          <div class="widget-content nopadding">
            <form class="form-horizontal" method="post" action="#" id="permission_action_form">
              <div class="control-group">
                <label class="control-label">权限接口</label>
                <div class="controls">
                  <input type="text" name="modelname" id="permission_action_username">
                </div>
              </div>
              <div class="control-group">
                <label class="control-label">权限名</label>
                <div class="controls">
                  <input type="text" name="permission" id="permission_action_password">
                </div>
              </div>
              <div class="control-group">
                <label class="control-label">*操作类型 :</label>
                <div class="controls">
                  <label>
                    <input type="radio" name="type" value=1 checked/>
                    增加</label>
                  <label>
                    <input type="radio" name="type" value=2 />
                    删除</label>
                  <label>
                    <input type="radio" name="type" value=3 />
                    修改</label>
                </div>
              </div>
              <div class="form-actions">
                <input type="button" value="保存" class="btn btn-success"  onclick="isvalid('权限操作')">
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- 角色分配 -->
    <div class="row-fluid">
      <div class="span12">
        <div class="widget-box">
          <div class="widget-title"> <span class="icon"> <i class="icon-info-sign"></i> </span>
            <h5>角色分配</h5>
          </div>
          <div class="widget-content nopadding">
            <form class="form-horizontal" method="post" action="#" id="user_role_action_form">
              <div class="control-group">
                <label class="control-label">用户名</label>
                <div class="controls">
                  <input type="text" name="username" id="user_role_action_username">
                </div>
              </div>
              <div class="control-group">
                <label class="control-label">预分配角色</label>
                <div class="controls">
                  <select multiple class="form-control" name="preRole" id="user_role_select_id">
                    <option th:each="role : ${roleList}" th:value="${role.rolename}">[[${role.rolename}]]</option>
                  </select>
                </div>
              </div>
              <div class="control-group">
                <label class="control-label">*操作类型 :</label>
                <div class="controls" id="user_role_checkbox">
                  <label>
                    <input type="radio" name="type" value=1 checked/>
                    增加</label>
                  <label>
                    <input type="radio" name="type" value=2 />
                    删除</label>
                </div>
              </div>
              <div class="control-group">
                <label class="control-label">*当前角色 :</label>
                <div class="controls" id="user_role_controls_info">
                  <span class="label label-info">未知</span>
                </div>
              </div>
              <div class="form-actions">
                <input type="button" value="保存" class="btn btn-success"  onclick="isvalid('角色分配')">
                <input type="button" value="查询角色" class="btn btn-info"  onclick="searchMsg('查询当前角色')">
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- 权限分配 -->
    <div class="row-fluid">
      <div class="span12">
        <div class="widget-box">
          <div class="widget-title"> <span class="icon"> <i class="icon-info-sign"></i> </span>
            <h5>权限分配</h5>
          </div>
          <div class="widget-content nopadding">
            <form class="form-horizontal" method="post" action="#" id="role_permission_action_form">
              <div class="control-group">
                <label class="control-label">角色名</label>
                <div class="controls">
                  <input type="text" name="rolename" id="role_permission_action_rolename">
                </div>
              </div>
              <div class="control-group">
                <label class="control-label">预分配权限</label>
                <div class="controls">
                  <select multiple class="form-control" name="prePermission" id="role_permission_select_id">
                    <option th:each="permission : ${permissionList}" th:value="${permission.modelname}">[[${permission.permission}]]</option>
                  </select>
                </div>
              </div>
              <div class="control-group">
                <label class="control-label">*操作类型 :</label>
                <div class="controls" id="role_permission_checkbox">
                  <label>
                    <input type="radio" name="type" value=1 checked/>
                    增加</label>
                  <label>
                    <input type="radio" name="type" value=2 />
                    删除</label>
                </div>
              </div>
              <div class="control-group">
                <label class="control-label">*当前权限 :</label>
                <div class="controls" id="role_permission_controls_info">
                  <span class="label label-info">未知</span>
                </div>
              </div>
              <div class="form-actions">
                <input type="button" value="保存" class="btn btn-success"  onclick="isvalid('权限分配')">
                <input type="button" value="查询权限" class="btn btn-info"  onclick="searchMsg('查询当前权限')">
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>
<!--Footer-part-->
<div th:replace="common/frame-footer::frame-footer"/>
<!--end-Footer-part-->

<script src="../static/js/jquery.ui.custom.js"></script>
<script src="../static/js/bootstrap.min.js"></script>
<script src="../static/js/jquery.uniform.js"></script>
<script src="../static/js/select2.min.js"></script>
<script src="../static/js/jquery.validate.js"></script>
<script src="../static/js/matrix.js"></script>
<script src="../static/js/matrix.form_validation.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
<script src="../static/js/jquery.min.js"></script>
<script type="text/javascript">
  $("#user_role_action_username").blur(function() {
    //进行相关操作
    searchMsg('查询当前角色')
  });
  $("#role_permission_action_rolename").blur(function() {
    //进行相关操作
    searchMsg('查询当前权限')
  });
  function searchMsg(actionMsg) {
    let data = {};
    let actionUrl = '';
    let curid = '';
    if (actionMsg === '查询当前角色') {
      data = {username:document.getElementById("user_role_action_username").value};
      actionUrl = '/user/searchCurRoleForUser';
      curid = "user_role_controls_info";
    } else if (actionMsg === '查询当前权限') {
      data = {rolename:document.getElementById("role_permission_action_rolename").value};
      actionUrl = '/user/searchCurPermissionForRole';
      curid = "role_permission_controls_info";
    }
    if (data !== {} && actionUrl !== '') {
      $.ajax({
        type: 'post',
        data: data,
        url: actionUrl,
        cache:false,
        dataType:'text',
        async:false,
        success: function (msg) {
          let optionJson = []
          if (msg === 'failed') {
            optionJson = ["无"]
          } else {
            optionJson = JSON.parse( msg );
          }
          let element = document.getElementById(curid);
          element.innerHTML = ""
          for (let i=0; i<optionJson.length; i++) {
            let span = document.createElement("span")
            let className = document.createAttribute("class")
            className.nodeValue = "label label-info"
            span.setAttributeNode(className)
            className = document.createAttribute("style")
            className.nodeValue = "margin-right:5px"
            span.setAttributeNode(className)
            span.innerHTML = optionJson[i]

            element.appendChild(span)
          }
        }
      });
    }
  }

  function isvalid(actionMsg) {
    let data = undefined;
    let actionUrl = undefined;
    if (actionMsg === '用户操作') {
      data = $('#user_action_form').serialize()
      actionUrl = '/user/userAction'
    } else if (actionMsg === '角色操作') {
      data = $('#role_action_form').serialize()
      actionUrl = '/user/roleAction'
    } else if (actionMsg === '权限操作') {
      data = $('#permission_action_form').serialize()
      actionUrl = '/user/permissionAction'
    } else if (actionMsg === '角色分配') {
      let obj = document.getElementById("user_role_checkbox").getElementsByTagName("input");
      let checkVal = 0
      for (let k in obj) {
        if (obj[k].checked) {
          checkVal = obj[k].value
        }
      }
      let select = document.getElementById("user_role_select_id")
      let att = []
      for (let i=0;i<select.length;i++) {
        if (select.options[i].selected) {
          att.push(select[i].value)
        }
      }
      data = {preRole:att,username:document.getElementById("user_role_action_username").value,type:checkVal}
      actionUrl = '/user/userRoleAction'
    } else if (actionMsg === '权限分配') {
      let obj = document.getElementById("role_permission_checkbox").getElementsByTagName("input");
      let checkVal = 0
      for (let k in obj) {
        if (obj[k].checked) {
          checkVal = obj[k].value
        }
      }
      let select = document.getElementById("role_permission_select_id")
      let att = []
      for (let i=0;i<select.length;i++) {
        if (select.options[i].selected) {
          att.push(select[i].value)
        }
      }
      data = {prePermission:att,rolename:document.getElementById("role_permission_action_rolename").value,type:checkVal}
      actionUrl = '/user/rolePermissionAction'
    }
    if (data !== undefined && actionUrl !== undefined) {
      $.ajax({
        type: 'post',
        data: data,
        url: actionUrl,
        cache:false,
        dataType:'text',
        async:false,
        success: function (msg) {
          if (msg === "success") {
            alert("提交成功！")
          } else {
            alert("提交失败！" + msg)
          }
        }
      });
    }
  }


</script>
</body>
</html>
